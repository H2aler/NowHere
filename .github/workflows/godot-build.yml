name: Godot Build

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Godot
      uses: firebelley/godot-action@v1
      with:
        godot-version: "4.2.2"
        godot-platform: "linux"
        
    - name: Create builds directory
      run: mkdir -p builds
      
    - name: Build Android APK
      run: |
        godot --headless --export-release "Android" builds/NowHere_Godot_Android.apk --path NowHere_Godot_Complete
        
    - name: Build Windows Executable
      run: |
        godot --headless --export-release "Windows Desktop" builds/NowHere_Godot_Windows.exe --path NowHere_Godot_Complete
        
    - name: Build Linux Executable
      run: |
        godot --headless --export-release "Linux/X11" builds/NowHere_Godot_Linux.x86_64 --path NowHere_Godot_Complete
        
    - name: Upload Android APK
      uses: actions/upload-artifact@v4
      with:
        name: NowHere_Godot_Android_APK
        path: builds/NowHere_Godot_Android.apk
        
    - name: Upload Windows Executable
      uses: actions/upload-artifact@v4
      with:
        name: NowHere_Godot_Windows_Executable
        path: builds/NowHere_Godot_Windows.exe
        
    - name: Upload Linux Executable
      uses: actions/upload-artifact@v4
      with:
        name: NowHere_Godot_Linux_Executable
        path: builds/NowHere_Godot_Linux.x86_64
        
    - name: Create Release
      if: github.ref == 'refs/heads/main'
      uses: softprops/action-gh-release@v1
      with:
        files: |
          builds/NowHere_Godot_Android.apk
          builds/NowHere_Godot_Windows.exe
          builds/NowHere_Godot_Linux.x86_64
        tag_name: v${{ github.run_number }}
        name: NowHere Godot Build v${{ github.run_number }}
        body: |
          # NowHere AR/VR/XR MMORPG - Godot Build
          
          ## ğŸ® ê²Œì„ ì •ë³´
          - **ì—”ì§„**: Godot 4.2.2
          - **í”Œë«í¼**: Android, Windows, Linux
          - **ê¸°ëŠ¥**: AR/VR/XR, ë©€í‹°í”Œë ˆì´ì–´, RPG ì‹œìŠ¤í…œ
          
          ## ğŸ“± Android APK
          - `NowHere_Godot_Android.apk`
          - Android 7.0+ ì§€ì›
          - ARCore ì§€ì›
          
          ## ğŸ–¥ï¸ Windows ì‹¤í–‰íŒŒì¼
          - `NowHere_Godot_Windows.exe`
          - Windows 10+ ì§€ì›
          
          ## ğŸ§ Linux ì‹¤í–‰íŒŒì¼
          - `NowHere_Godot_Linux.x86_64`
          - Linux x86_64 ì§€ì›
          
          ## ğŸš€ ì„¤ì¹˜ ë°©ë²•
          1. í•´ë‹¹ í”Œë«í¼ì˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
          2. ì‹¤í–‰/ì„¤ì¹˜
          3. ê²Œì„ ì‹œì‘!
          
          ## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥
          - âœ… AR ëª¨ë“œ (ARCore ì§€ì›)
          - âœ… VR ëª¨ë“œ (OpenXR ì§€ì›)
          - âœ… ë©€í‹°í”Œë ˆì´ì–´
          - âœ… RPG ì‹œìŠ¤í…œ
          - âœ… ì „íˆ¬ ì‹œìŠ¤í…œ
          - âœ… ì €ì¥/ë¡œë“œ
          - âœ… ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œ
          
          **Unity ë¼ì´ì„ ìŠ¤ ë¬¸ì œ ì™„ì „ í•´ê²°!** ğŸ‰
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}